== Gcp Service Account Controller

image:https://travis-ci.com/kiwigrid/gcp-serviceaccount-controller.svg?branch=master["Build Status", link="https://travis-ci.com/kiwigrid/gcp-serviceaccount-controller"]

this controller manges gcp service account over kubernetes resources.


The build tooling for travis is used from https://github.com/IBM/openwhisk-operator

=== Helm Deployment

first you need to create a GCP service account with at least the following permissions:

----
- iam.serviceAccounts.create
- iam.serviceAccounts.delete
- iam.serviceAccounts.get
- iam.serviceAccounts.list
- iam.serviceAccounts.update
- iam.serviceAccountKeys.create
- iam.serviceAccountKeys.delete
- iam.serviceAccountKeys.get
- iam.serviceAccountKeys.list
- pubsub.subscriptions.getIamPolicy
- pubsub.subscriptions.setIamPolicy
- pubsub.topics.getIamPolicy
- pubsub.topics.setIamPolicy
- storage.buckets.getIamPolicy
- storage.buckets.setIamPolicy
- resourcemanager.projects.getIamPolicy
- resourcemanager.projects.setIamPolicy
----

Then add the base64 encoded file to the `gcpCredentials` value.

----
helm upgrade -i -f <YOUR_VALUES_FILE> <RELEASE_NAME> helm/
----

=== Example

This is an example resource definition for a service account:
[source,yaml]
----
apiVersion: gcp.kiwigrid.com/v1beta1
kind: GcpServiceAccount
metadata:
  name: gcpserviceaccount-sample
spec:
  serviceAccountIdentifier: kube-example
  serviceAccountDescription: kube-example
  secretName: kube-example-secret
  bindings:
  - resource: "//cloudresourcemanager.googleapis.com/projects/<PROJECT_NAME>"
    roles:
    - "roles/cloudsql.editor"
----